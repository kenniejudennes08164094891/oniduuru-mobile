<ion-header>
  <app-scouter-header></app-scouter-header>
</ion-header>

<ion-content class="ion-padding">
  <!-- Top card -->
  <div
    class="paid-dark-card-background relative rounded-lg px-4 py-10 mb-6 overflow-hidden"
  >
    <div class="relative z-10 text-white">
      <div class="flex items-start gap-3">
        <img [src]="images.ViewHireFolderIcon" alt="" />
        <div class="items-center">
          <span class="font-medium text-[24px] leading-tight">
            Hi {{ userName || 'User' }},
          </span>
          <p class="text-gray-200 text-lg leading-relaxed">
            View specific details of your fund deposit request.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="space-y-5">
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Designated Wallet Name
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">
          {{ deposit?.walletName }}
        </p>
      </div>
    </div>
    <div
      class="bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Designated Wallet Account
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">
          {{ deposit?.walletAcctNo }}
        </p>
      </div>
    </div>
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Amount Deposited
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">
          ₦{{ deposit?.amount | number }}
        </p>
      </div>
    </div>
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Deposit Identifiers
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">
          {{ deposit?.identifier }}
        </p>
      </div>
    </div>
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Agreed to terms
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">Yes</p>
      </div>
    </div>
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">Payment Status</h4>

        <span *ngIf="deposit as d">
          <span
            [ngClass]="[
              'rounded-full h-2 w-2 inline-block',
              d.status === 'Successful' ? 'bg-[#057A55]' : '',
              d.status === 'Invalid' ? 'bg-[#EB0B00]' : '',
              d.status === 'Failed' ? 'bg-[#EB0B00]' : '',
              d.status === 'Reversed' ? 'bg-[#0033FF]' : '',
            ]"
          ></span>
          {{ d.status }}
        </span>
      </div>
    </div>
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Date of Deposit Request
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">
          {{ deposit?.date | date: "MMM d, y h:mma" }}
        </p>
      </div>
    </div>
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Deposit Reference ID
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">
          {{ referenceId || "Loading..." }}
        </p>
      </div>
    </div>
    <div
      class="space-y-5 bg-[#F8FAFC] border-[1px] border-[#E3E5EA] text-center py-6 rounded-lg shadow-lg"
    >
      <div class="">
        <h4 class="text-[20px] text-[#101828] font-semibold">
          Reason for Deposit
        </h4>
        <p class="text-[16px] text-[#919194] font-normal">
          {{ deposit?.reason }}
        </p>
      </div>
    </div>
  </div>

  <div *ngIf="isLoadingReceipt" class="flex justify-center items-center py-10">
    <div class="text-center">
      <svg
        class="animate-spin h-8 w-8 text-indigo-600 mx-auto"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
        ></path>
      </svg>
      <p class="text-gray-500 mt-2">Loading receipt...</p>
    </div>
  </div>

  <!-- THEN A VERSION OF THE RECIEPT GENERATED GOES HERE -->
  <div *ngIf="!isLoadingReceipt" class="p-4 mt-10">
    <!-- Show API receipt if available -->
    <div
      *ngIf="receiptUrl; else htmlReceipt"
      class="flex flex-col items-center"
    >
      <div
        class="bg-white rounded-2xl shadow-lg w-[350px] mx-auto border border-[#E3E5EA] overflow-hidden p-4"
      >
        <img
          [src]="receiptUrl"
          alt="Transaction Receipt"
          class="w-full h-auto rounded-lg"
          (load)="onReceiptLoaded()"
          (error)="onReceiptError()"
        />
      </div>
      <p class="text-sm text-gray-500 mt-2">
        Official Receipt from Shoft Africa
      </p>
    </div>

    <ng-template #htmlReceipt>
      <div
        id="receipt"
        class="bg-white w-full h-full mx-auto shadow-md rounded-md"
      >
        <div
          class="logcomplainModalBG flex justify-center items-center px-4 py-3 border-b rounded-t-xl bg-[#1A1A1A]"
        >
          <h2 class="text-lg font-bold text-white">Withdrawal Receipt</h2>
        </div>

        <div class="px-4 py-6">
          <!-- Powered by -->
          <h3 class="w-full mx-auto p-3 text-[#49536E] text-[16px] text-center">
            Powered by Shoft Africa ❤️
          </h3>

          <!-- Gradient Bar -->
          <div
            class="w-full h-2 rounded-full my-4"
            style="
              background: linear-gradient(to right, #daa21f, #cc0000, #057a55);
            "
          ></div>

          <!-- Parties -->
          <div class="space-y-2">
            <div
              class="flex justify-between items-center text-[#49536E] text-[12px]"
            >
              <span>From(Wallet)</span>
              <span>To (Bank)</span>
            </div>
            <div
              class="flex justify-between items-center text-[#101828] text-[12px] font-semibold"
            >
              <!-- From Name: your platform wallet user -->
              <span>{{ deposit?.fromName || "Omosehin Kehinde Jude" }}</span>
              <!-- To Name: actual bank account name -->
              <span>{{ deposit?.acctName || "Olorunda Victory Chidi" }}</span>
            </div>
            <div
              class="flex justify-between items-center text-[12px] text-[#49536E]"
            >
              <span
                >Wallet ID: {{ deposit?.walletAcctNo || "0325062797" }}</span
              >
              <!-- <span>Wallet ID: {{ toWalletId || "" }}</span> -->
            </div>
          </div>

          <div
            class="space-y-4 mt-6 bg-[#F3F4F6] px-4 py-2 rounded-lg text-[#49536E] text-[12px]"
          >
            <p class="flex justify-between items-center">
              <span>Amount Deposited</span
              ><span class="text-[13px] text-[#057A55] font-semibold"
                >₦{{ deposit?.amount | number }}
              </span>
            </p>
            <p class="flex justify-between items-center">
              <span>Transaction ID</span>
              <span>{{ referenceId }}</span>
            </p>
            <p class="flex justify-between items-center">
              <span>Bank Name</span> <span>{{ deposit?.bank }}</span>
            </p>
            <p class="flex justify-between items-center">
              <span>Account Number</span>
              <span>{{ deposit?.nubamAccNo }}</span>
            </p>
            <p class="flex justify-between items-center">
              <span>Date</span>
              <span>{{ deposit?.date | date: "MMM d, y h:mma" }}</span>
            </p>
            <p class="flex justify-between items-center">
              <span>Status</span>
              <span *ngIf="deposit as w">
                <span
                  [ngClass]="[
                    '',
                    w.status === 'Successful' ? 'text-[#057A55]' : '',
                    w.status === 'Pending' ? 'text-[#EB0B00]' : '',
                    w.status === 'Reversed' ? 'text-[#0033FF]' : '',
                    w.status === 'Declined' ? 'text-[#EB0B00]' : '',
                  ]"
                >
                  {{ w.status }}
                </span>
              </span>
            </p>
          </div>
          <!-- Footer -->
          <div class="w-full mx-auto mt-6 text-center">
            <p class="p-3 text-[#49536E] text-[16px]">
              Thanks for trusting Oniduuru ∯
            </p>
            <p class="text-[#968A64] text-[12px]">
              <span>#Secure.</span><span>#Fast.</span
              ><span>#ProudlyAfrican</span>
            </p>
          </div>
        </div>
      </div>
    </ng-template>

    <button
      (click)="downloadReceipt()"
      [disabled]="isDownloading"
      class="bg-[#101828] text-white px-6 py-2 text-[20px] font-medium rounded-lg mt-10 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed w-full"
    >
      <span *ngIf="!isDownloading">Download Receipt</span>
      <span *ngIf="isDownloading" class="flex items-center gap-2">
        <svg
          class="animate-spin h-5 w-5 text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
          ></path>
        </svg>
        <span>Downloading...</span>
      </span>
    </button>

    <!-- Optional: Show receipt preview if URL is available -->
    <div *ngIf="receiptUrl" class="mt-4 text-center">
      <p class="text-sm text-green-600 mb-2">Receipt available</p>
     <!-- Button to open modal -->
          <button
            *ngIf="receiptUrl"
            (click)="showReceiptModal = true"
            class="mt-4 text-white bg-[#000000] px-2 py-2 rounded-lg"
          >
            Preview Receipt
          </button>
    </div>

    
  </div>
</ion-content>

<!-- Receipt Preview Modal -->
<ion-modal [isOpen]="showReceiptModal" (didDismiss)="showReceiptModal = false">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Receipt Preview</ion-title>
        <ion-buttons slot="end">
          <!-- <ion-button (click)="showReceiptModal = false">Close</ion-button> -->
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <div class="flex flex-col items-center">
        <img
          *ngIf="receiptUrl"
          [src]="receiptUrl"
          alt="Transaction Receipt"
          class="w-full max-w-md rounded-lg shadow-lg"
        />
        <div class="flex gap-4 mt-6">
          <button
            (click)="downloadReceipt()"
            class="bg-[#101828] text-white px-6 py-2 rounded-lg"
          >
            Download
          </button>
          <button
            (click)="showReceiptModal = false"
            class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg"
          >
            Close
          </button>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>


          