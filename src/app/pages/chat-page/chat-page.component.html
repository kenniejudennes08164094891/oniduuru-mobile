<ion-header [translucent]="true" class="chatBotPageHeaderBg">
  <ion-toolbar class="chatBotPageHeaderBg">
    <ion-buttons slot="start">
      <!-- REPLACE ion-back-button with custom button -->
      <!-- <ion-button (click)="goBackImmediately()" class="text-white" fill="clear">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon> Back
      </ion-button> -->
    </ion-buttons>
    <ion-title class="text-white font-bold">ü§ñ √ín√≠ √åb√©√®r√® Chatbot</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="clearChat()" fill="clear" class="text-white">
        <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-gray-50">
  <div class="min-h-full flex flex-col max-w-4xl mx-auto">
    <!-- Header Content Section - Now moved into the header background -->
    <div class="px-6 py-8 text-white">
      <div class="flex items-center space-x-4"></div>
    </div>

    <!-- Messages Container -->
    <div #messagesContainer class="flex-1 p-4 overflow-y-auto -mt-40">
      <div class="space-y-4 max-w-2xl mx-auto w-full">
        <div *ngFor="let message of messages" class="flex flex-col">
          <!-- Bot Message -->
          <div
            *ngIf="message.sender === 'bot'"
            class="flex items-start space-x-3"
          >
            <div
              class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center shadow-md"
            >
              <span class="text-white text-sm font-bold">O</span>
            </div>
            <div
              class="bg-white rounded-2xl rounded-tl-none px-6 py-4 shadow-sm border border-gray-100 max-w-[80%]"
            >
              <p class="text-gray-800 text-base leading-relaxed">
                {{ message.text }}
              </p>
              <p class="text-gray-400 text-xs mt-2">
                {{ message.timestamp | date : "shortTime" }}
              </p>
            </div>
          </div>

          <!-- User Message -->
          <div
            *ngIf="message.sender === 'user'"
            class="flex items-start justify-end space-x-3"
          >
            <div
              class="bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl rounded-tr-none px-6 py-4 shadow-sm max-w-[80%]"
            >
              <p class="text-white text-base leading-relaxed">
                {{ message.text }}
              </p>
              <p class="text-blue-100 text-xs mt-2">
                {{ message.timestamp | date : "shortTime" }}
              </p>
            </div>
            <div
              class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex-shrink-0 flex items-center justify-center shadow-md"
            >
              <span class="text-white text-sm font-bold">Y</span>
            </div>
          </div>
        </div>

        <!-- Loading Indicator -->
        <div *ngIf="isLoading" class="flex items-start space-x-3">
          <div
            class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center shadow-md"
          >
            <span class="text-white text-sm font-bold">O</span>
          </div>
          <div
            class="bg-white rounded-2xl rounded-tl-none px-6 py-4 shadow-sm border border-gray-100"
          >
            <div class="flex space-x-2">
              <div
                class="w-3 h-3 bg-gray-400 rounded-full animate-bounce"
              ></div>
              <div
                class="w-3 h-3 bg-gray-400 rounded-full animate-bounce"
                style="animation-delay: 0.1s"
              ></div>
              <div
                class="w-3 h-3 bg-gray-400 rounded-full animate-bounce"
                style="animation-delay: 0.2s"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="border-t border-gray-200 bg-white p-4 sticky bottom-0">
      <div class="max-w-2xl mx-auto">
        <div class="flex items-center space-x-3">
          <div class="flex-1 relative">
            <textarea
              [(ngModel)]="newMessage"
              (keydown)="onKeyPress($event)"
              placeholder="Ask √ín√≠ √åb√©√®r√® anything..."
              [disabled]="isLoading"
              class="w-full border border-gray-300 rounded-2xl px-4 py-3 pr-12 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base disabled:bg-gray-100 disabled:cursor-not-allowed transition-all duration-200"
              rows="2"
            ></textarea>
          </div>
          <button
            (click)="sendMessage()"
            [disabled]="!newMessage.trim() || isLoading"
            class="bg-black text-white rounded-2xl w-12 h-12 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md"
          >
            <svg
              *ngIf="!isLoading"
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
              />
            </svg>
            <div
              *ngIf="isLoading"
              class="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"
            ></div>
          </button>
        </div>
        <p class="text-gray-500 text-xs text-center mt-2">
          <!-- Press Enter to send ‚Ä¢ Shift+Enter for new line -->
        </p>
      </div>
    </div>
  </div>
</ion-content>
