<ion-header class="bg-white">
  <ion-toolbar>
    <div class="w-full flex justify-between items-center px-4 py-2">
      <button class="text-xl md:text-2xl font-semibold text-[#101828]">∯ Oniduuru</button>

      <div class="flex items-center gap-2 md:gap-4">
        <button
          (click)="goBack()"
          class="shadow-lg px-3 py-2 md:px-5 md:py-2 rounded-xl border-2 border-white bg-[#101828] text-white text-sm md:text-base"
        >
          Back
        </button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="flex flex-col min-h-screen max-w-md mx-auto w-full py-4 md:py-8">

    <!-- Title Section -->
    <div class="text-center mb-6 md:mb-8">
      <h1 class="text-2xl md:text-3xl font-bold text-[#101828] mb-2">
        Verify Your Account
      </h1>
      <p class="text-[#667085] text-sm md:text-base">
        Enter the verification code sent to your email
      </p>
    </div>

    <!-- Error Message -->
    <div
      *ngIf="errorMessage"
      class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 text-sm"
    >
      ⚠️ {{ errorMessage }}
    </div>

    <!-- OTP Verification Form -->
    <form [formGroup]="otpForm" class="space-y-6">

      <!-- Email Display -->
      <div class="text-center">
        <p class="text-[#101828] font-medium">
          {{ maskEmail(email) }}
        </p>
        <p class="text-[#667085] text-sm mt-1">
          We sent a 4-digit code to this email address
        </p>
      </div>

      <!-- OTP Input Boxes -->
      <div class="space-y-4">
        <div class="flex justify-center gap-2 md:gap-4">
          <input
            *ngFor="let ctrl of otpControls; let i = index"
            type="text"
            maxlength="1"
            inputmode="numeric"
            [formControl]="ctrl"
            (input)="onOtpInput($event, i)"
            (keydown)="onKeyDown($event, i)"
            class="w-14 h-14 md:w-16 md:h-16 text-2xl md:text-[28px] text-center border-2 border-[#D0D5DD] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#101828] focus:border-[#101828] transition-all duration-200 bg-white"
            [class.border-[#101828]]="ctrl.touched && !ctrl.errors"
            [class.border-red-500]="ctrl.touched && ctrl.errors"
          />
        </div>

        <!-- Input Hint -->
        <p class="text-center text-[#667085] text-xs md:text-sm">
          Tap on each box to enter the code
        </p>
      </div>

      <!-- Resend OTP Section -->
      <div class="text-center">
        <p class="text-[#667085] text-sm md:text-base">
          Didn't receive the code?
          <button
            *ngIf="countdown === 0"
            (click)="resendOtp()"
            type="button"
            class="text-[#101828] font-medium hover:underline ml-1"
            [disabled]="isProcessing"
          >
            Resend OTP
          </button>
          <span *ngIf="countdown > 0" class="text-[#101828] font-medium ml-1">
            Resend available in {{ countdown }}s
          </span>
        </p>
      </div>

      <!-- Verify Button -->
      <button
        type="button"
        (click)="verifyOtpAndProceed()"
        [disabled]="otpForm.invalid || isProcessing"
        class="w-full bg-[#101828] text-white py-4 rounded-xl font-medium text-base disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center gap-2"
      >
        <ion-spinner *ngIf="isProcessing" name="crescent" class="text-white"></ion-spinner>
        <span>{{ isProcessing ? 'Verifying...' : 'Verify Account' }}</span>
      </button>

      <!-- Back to Login -->
      <div class="text-center">
        <button
          type="button"
          (click)="goToLogin()"
          class="text-[#667085] text-sm md:text-base hover:text-[#101828] transition-colors duration-200"
        >
          ← Back to Login
        </button>
      </div>
    </form>

    <!-- Help Text -->
    <div class="mt-8 md:mt-12 text-center">
      <p class="text-[#667085] text-xs md:text-sm">
        Having trouble receiving the code?<br>
        Check your spam folder or ensure your email address is correct.
      </p>
    </div>
  </div>
</ion-content>
