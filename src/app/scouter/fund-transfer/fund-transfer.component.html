<ion-header>
  <app-scouter-header></app-scouter-header>
</ion-header>

<ion-content class="ion-padding">
  <!-- Top card -->
  <div
    class="paid-dark-card-background relative rounded-lg px-4 py-10 mb-6 overflow-hidden"
  >
    <div class="absolute inset-0 bg-black bg-opacity-0 z-0"></div>
    <div class="relative z-10 text-white">
      <div class="flex items-start gap-3">
        <img [src]="images.ViewHireFolderIcon" alt="" />
        <div class="items-center">
          <span class="font-medium text-[24px] leading-tight">
            Hi {{ userName || 'User' }},
          </span>
          <p class="text-gray-200 text-lg leading-relaxed">
            Seamlessly transfer funds between wallets.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Fund wallet button -->
  <div
    class="shadow-xl bg-white rounded-xl px-6 py-10 w-full flex justify-between items-center"
  >
    <p class="text-[16px] text-[#101828]">Recent fund Transfers</p>

    <button
      (click)="openTransferFundsPopup()"
      class="bg-[#101828] px-8 py-3 rounded-md text-white font-semibold text-[16px]"
    >
      Fund Transfer
    </button>
  </div>

  <!-- Dropdowns -->
  <div class="space-y-4 mt-6">
    <!-- Year Dropdown -->
    <div class="relative w-[40%]">
      <div
        class="border border-[#D9DCE5] rounded-md px-4 py-4 bg-[#F6F6F6] flex justify-between items-center cursor-pointer"
        (click)="toggleYearDropdown()"
      >
        <span class="text-[#101828] text-[14px]">
          {{ selectedYear || "Select a Year" }}
        </span>
        <ion-icon
          [name]="
            isYearDropdownOpen ? 'chevron-up-outline' : 'chevron-down-outline'
          "
        ></ion-icon>
      </div>
      <div
        *ngIf="isYearDropdownOpen"
        class="absolute mt-2 bg-white border rounded-md shadow-md w-full z-10 max-h-60 overflow-y-auto"
      >
        <p
          *ngFor="let year of years"
          class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
          (click)="selectYear(year)"
        >
          {{ year }}
        </p>
      </div>
    </div>

    <!-- Month Dropdown -->
    <div class="relative w-[40%]">
      <div
        class="border border-[#D9DCE5] rounded-md px-4 py-4 bg-[#F6F6F6] flex justify-between items-center cursor-pointer"
        (click)="toggleMonthDropdown()"
      >
        <span class="text-[#101828] text-[14px]">
          {{ selectedMonth || "Select a Month" }}
        </span>
        <ion-icon
          [name]="
            isMonthDropdownOpen ? 'chevron-up-outline' : 'chevron-down-outline'
          "
        ></ion-icon>
      </div>
      <div
        *ngIf="isMonthDropdownOpen"
        class="absolute mt-2 bg-white border rounded-md shadow-md w-full z-10 max-h-60 overflow-y-auto"
      >
        <p
          *ngFor="let month of months"
          class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
          (click)="selectMonth(month)"
        >
          {{ month }}
        </p>
      </div>
    </div>
  </div>

  <div class="overflow-x-auto mt-10">
    <div
      class="flex space-x-4 bg-white py-3 md:space-x-6 md:justify-between md:flex-wrap"
    >
      <!-- Successful -->
      <button
        (click)="filterByStatus('Successful')"
        [class]="getStatusButtonClass('Successful')"
      >
        <p class="text-lg font-semibold">{{ successfulCount }}</p>
        <p>Successful</p>
      </button>

      <!-- Pending -->
      <button
        (click)="filterByStatus('Pending')"
        [class]="getStatusButtonClass('Pending')"
      >
        <p class="text-lg font-semibold">{{ pendingCount }}</p>
        <p>Pending</p>
      </button>

      <!-- Reversed -->
      <button
        (click)="filterByStatus('Reversed')"
        [class]="getStatusButtonClass('Reversed')"
      >
        <p class="text-lg font-semibold">{{ reversedCount }}</p>
        <p>Reversed</p>
      </button>

      <!-- Declined -->
      <button
        (click)="filterByStatus('Declined')"
        [class]="getStatusButtonClass('Declined')"
      >
        <p class="text-lg font-semibold">{{ declinedCount }}</p>
        <p>Declined</p>
      </button>

      <!-- All transfers -->
      <button
        (click)="loadTransfers()"
        [class]="
          'min-w-[120px] md:flex-1 flex flex-col items-center justify-center text-gray-500 text-sm bg-[#E5E7EB] px-6 py-4 rounded-md hover:bg-gray-200 transition-colors cursor-pointer ' +
          (activeStatusFilter === null
            ? 'ring-2 ring-offset-2 ring-indigo-500 bg-gray-100'
            : '')
        "
      >
        <p class="text-lg font-semibold">{{ totalCount }}</p>
        <p>All transfers</p>
      </button>
    </div>
  </div>

  <!-- Clear Filters Button -->
  <div *ngIf="selectedYear || selectedMonth || activeStatusFilter" class="mt-4">
    <button
      (click)="clearFilters()"
      class="text-indigo-600 text-sm font-medium hover:text-indigo-800"
    >
      Clear all filters
    </button>
  </div>

  <!-- TABLE + Pagination -->
  <div class="mt-10">
    <div class="overflow-x-auto bg-white shadow-sm">
      <table
        *ngIf="paginatedTransfer.length > 0; else noDataTable"
        class="min-w-full text-sm text-left text-gray-700"
      >
        <thead
          class="border-b text-xs uppercase h-16 bg-[#E5E7EB] text-gray-500"
        >
          <tr>
            <th></th>
            <th class="pr-4 pl-1 py-3">Amount</th>
            <th class="px-4 py-3">DESIGNATED WALLET ID</th>
            <th class="px-4 py-3">DESIGNATED WALLET NAME</th>
            <th class="px-4 py-3">STATUS</th>
            <th class="px-4 py-3">DATE OF TRANSFER</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-gray-100">
          <tr
            *ngFor="let transfer of paginatedTransfer"
            (click)="openTransfer(transfer)"
            class="hover:bg-gray-50 transition-colors h-16 cursor-pointer"
          >
            <td class="px-3 py-3 text-center">
              <input
                type="checkbox"
                class="accent-indigo-600 rounded-sm bg-[#E5E7EB]"
              />
            </td>
            <td class="pr-4 pl-1 sm:px-6 py-3 gap-2 sm:gap-3">
              <p
                class="text-xs sm:text-sm text-gray-500 flex gap-[2px] items-center w-full"
              >
                <span>₦</span> {{ transfer.amount | number }}
              </p>
            </td>
            <td
              class="px-3 sm:px-6 py-3 text-xs sm:text-sm text-gray-600 whitespace-nowrap"
            >
              {{ transfer.walletId }}
            </td>
            <td
              class="px-3 sm:px-6 py-3 font-semibold text-gray-600 text-sm sm:text-base whitespace-nowrap"
            >
              {{ transfer.walletName }}
            </td>
            <td
              class="px-3 sm:px-6 py-3 font-semibold text-sm sm:text-base whitespace-nowrap"
            >
              <span
                [ngClass]="[
                  'rounded-full h-2 w-2 inline-block',
                  transfer.status === 'Successful' ? 'bg-[#057A55]' : '',
                  transfer.status === 'Pending' ? 'bg-[#FFA086]' : '',
                  transfer.status === 'Declined' ? 'bg-red-600' : '',
                  transfer.status === 'Reversed' ? 'bg-[#0033FF]' : '',
                ]"
              ></span>
              {{ transfer.status }}
            </td>
            <td
              class="px-3 sm:px-6 py-3 font-semibold text-gray-600 text-sm sm:text-base whitespace-nowrap"
            >
              {{ transfer.date | date: "MMM d, y h:mma" }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ✅ Empty state tbody -->
    <ng-template #noDataTable>
      <tbody class="flex justify-center">
        <tr>
          <td class="text-center text-gray-500 py-6">
            <img [src]="images.NoDataImage" class="mx-auto" alt="No Data" />
            <p class="text-lg font-medium">No transfers found</p>
            <p class="text-sm text-gray-400">Try adjusting your filters</p>
          </td>
        </tr>
      </tbody>
    </ng-template>

    <!-- Pagination -->
    <div
      class="flex justify-between items-center px-4 sm:px-6 py-3 gap-3 bg-gray-50 border-t border-gray-200"
    >
      <button
        (click)="goToPage(currentPage - 1)"
        [disabled]="currentPage === 1"
        class="pagination-button flex items-center px-3 py-2 gap-2 border border-gray-500 rounded-lg text-sm font-medium bg-white hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition"
      >
        <ion-icon name="chevron-back-outline"></ion-icon>
        Previous
      </button>

      <span class="flex gap-2 text-xs sm:text-sm text-gray-600 items-center">
        <span
          class="bg-indigo-50 text-indigo-600 font-medium px-2 sm:px-3 py-1 rounded-md"
        >
          {{ currentPage }}
        </span>
        <span class="bg-gray-100 px-2 sm:px-3 py-1 rounded-md">
          {{ totalPages }}
        </span>
      </span>

      <button
        (click)="goToPage(currentPage + 1)"
        [disabled]="currentPage === totalPages"
        class="pagination-button flex items-center px-3 py-2 gap-2 border border-gray-500 rounded-lg text-sm font-medium bg-white hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition"
      >
        Next <ion-icon name="chevron-forward-outline"></ion-icon>
      </button>
    </div>
  </div>
</ion-content>
