<ion-header class="bg-white">
  <div class="w-full flex justify-between items-center px-4 py-2">
    <button class="text-2xl font-semibold text-[#101828]">∯ Oniduuru</button>

    <div class="flex items-center gap-4">
      <button
        (click)="goBack()"
        class="shadow-2xl px-5 py-2 rounded-xl border border-white bg-[#CDD5DF80] text-white"
      >
        Back
      </button>
    </div>
  </div>
</ion-header>

<!-- Scrollable full page -->
<ion-content [fullscreen]="true" class="">
  <!-- Title Section -->
  <div class="py-6 px-4 bg-[#F1F1F1] text-[#101828] text-[24px]">
    <span>Create an account</span>
  </div>
  <div class="flex flex-col min-h-full ion-padding mt-4">
    <!-- TOP SECTION (progress, steps, forms) -->
    <div class="flex-1">
      <!-- Progress Bar -->
      <div class="w-full h-2 bg-[#E5E7EB] mb-6">
        <div
          class="h-2 bg-[#364152] transition-all duration-500"
          [style.width]="getProgressWidth()"
        ></div>
      </div>

      <!-- Step Indicator -->
      <div
        class="flex justify-between items-center border-b border-[#EAECF0] pb-2"
      >
        <ng-container *ngFor="let step of steps; let i = index">
          <p
            [ngClass]="
              i === currentStep ? 'text-[#CC0000] font-medium' : 'text-[#667085]'
            "
          >
            {{ step }}
          </p>
        </ng-container>
      </div>

      <!-- Dynamic Form Step -->
      <div class="mt-10 flex-1">
        <h4 class="text-[#202939] text-[18px] font-semibold">
          {{ steps[currentStep] }}
        </h4>

        <!-- STEP 1 -->
        <form
          *ngIf="currentStep === 0"
          [formGroup]="forms[0]"
          class="mt-4 space-y-6"
        >
          <div class="space-y-2">
            <label for="fullname">Full Name</label>
            <input
              id="fullname"
              type="text"
              formControlName="fullname"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="Enter your first and last name"
            />
          </div>

          <div class="space-y-2">
            <label for="phone">Phone Number</label>
            <input
              id="phone"
              type="tel"
              formControlName="phone"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="e.g 09012345678"
            />
          </div>

          <div class="space-y-2">
            <label for="email">Email Address</label>
            <input
              id="email"
              type="email"
              formControlName="email"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="aka.saka@gmail.com"
            />
          </div>
        </form>

        <!-- STEP 2 -->
        <form
          *ngIf="currentStep === 1"
          [formGroup]="forms[1]"
          class="mt-4 space-y-6"
        >
          <div class="space-y-2">
            <label for="location">Enter your Location</label>
            <input
              id="location"
              type="text"
              formControlName="location"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="e.g Ikeja, Lagos"
            />
          </div>

          <div class="space-y-2">
            <label for="organisation">Type of Organization</label>
            <div class="relative">
              <div
                class="border border-[#D9DCE5] rounded-md px-4 py-3 bg-[#F6F6F6] flex justify-between items-center cursor-pointer"
                (click)="toggleOrganisationDropdown()"
              >
                <span
                  class="text-[14px]"
                  [ngClass]="
                    forms[1].get('organisation')?.value
                      ? 'text-[#101828]'
                      : 'text-gray-400'
                  "
                >
                  {{ forms[1].get('organisation')?.value || "Select
                  Organisation" }}
                </span>

                <ion-icon
                  [name]="
                    isOrganisationDropdownOpen
                      ? 'chevron-up-outline'
                      : 'chevron-down-outline'
                  "
                ></ion-icon>
              </div>

              <div
                *ngIf="isOrganisationDropdownOpen"
                class="absolute mt-2 bg-white border rounded-md shadow-md w-full z-10 overflow-y-auto max-h-60"
              >
                <p
                  *ngFor="let organisation of organizationTypes"
                  class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                  (click)="selectOrganisation(organisation)"
                >
                  {{ organisation }}
                </p>
              </div>
            </div>
          </div>

          <div class="space-y-2">
            <label for="purpose">Purpose for finding Talent</label>
            <input
              id="purpose"
              type="text"
              formControlName="purpose"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="e.g For a concert"
            />
          </div>

          <div class="space-y-2">
            <label for="payRange">Pay Range</label>
            <input
              id="payRange"
              type="number"
              formControlName="payRange"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="Select the amount you are willing to pay"
            />
            <div
              *ngIf="forms[1].get('payRange')?.touched && forms[1].get('payRange')?.invalid"
              class="text-red-600 text-sm"
            >
              Pay range is required and must be greater than 0.
            </div>
          </div>
        </form>

        <!-- STEP 3 -->
        <form
          *ngIf="currentStep === 2"
          [formGroup]="forms[2]"
          class="mt-4 space-y-6"
        >
          <div class="space-y-2">
            <label for="username">Email Address</label>
            <input
              id="username"
              type="text"
              formControlName="username"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="aka.saka@gmail.com"
            />
          </div>
          <div class="space-y-2">
            <label for="password">Create Password</label>
            <input
              id="password"
              type="password"
              formControlName="password"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="Enter password"
            />
            <span>
              Password must contain 8+ characters, including uppercase,
              lowercase, and special characters.
            </span>
          </div>

          <div class="space-y-2">
            <label for="confirmPassword">Confirm Password</label>
            <input
              id="confirmPassword"
              type="password"
              formControlName="confirmPassword"
              class="border border-[#D0D5DD] px-3 py-2 w-full rounded-lg"
              placeholder="Re-enter your password"
            />
          </div>
        </form>

        <!-- STEP 4 -->
        <form
          *ngIf="currentStep === 3"
          [formGroup]="forms[3]"
          class="mt-4 space-y-6"
        >
          <p class="py-6 px-1 text-[#101828] text-[16px]">
            To ensure the security of your information, we require an OTP
            verification to authorize your talent hiring. Please complete this
            step to proceed.
          </p>
          <p class="text-[12px] px-1 text-[#101828]">
            Enter the OTP that was sent to your email address or phone number.
          </p>

          <!-- OTP Input Boxes -->
          <div class="flex justify-center gap-3 my-6">
            <input
              *ngFor="let ctrl of otpControls; let i = index"
              type="text"
              maxlength="1"
              inputmode="numeric"
              class="w-16 h-16 text-[40px] text-center border border-[#D0D5DD] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#101828] placeholder:text-[#D0D5DD] placeholder:text-[48px]"
              [formControl]="ctrl"
              (input)="onOtpInput($event, i)"
              (keydown)="onKeyDown($event, i)"
            />
          </div>

          <!-- Countdown -->
          <p class="text-center text-sm text-[#101828]">
            Didn’t receive a code?
            <span *ngIf="countdown > 0">
              Re-initiate OTP process in <strong>{{ countdown }}</strong>s
            </span>
            <a
              *ngIf="countdown === 0"
              href="#"
              class="text-blue-600 underline"
              (click)="resendOtp()"
              >Resend OTP</a
            >
          </p>

          <!-- Action Buttons -->
          <div class="mt-6 space-y-3">
            <button
              type="button"
              class="flex justify-center bg-white border-[1px] border-solid border-[#101828] rounded-lg w-full py-2 text-[#101828] font-medium cursor-pointer"
              (click)="goToDashboard()"
            >
              Route Back
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- BOTTOM BUTTONS -->
    <div class="space-y-4 mt-20 pb-24">
      <!-- NEXT -->
      <button
        (click)="goNext()"
        [disabled]="!isCurrentFormValid()"
        class="bg-[#101828] rounded-lg w-full py-2 text-white font-medium cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ currentStep === steps.length - 1 ? "Finish" : "Next" }}
      </button>

      <!-- PREVIOUS -->
      <button
        *ngIf="currentStep > 0"
        (click)="goPrevious()"
        class="bg-white border-2 border-[#D0D5DD] shadow-lg rounded-lg w-full py-2 text-black font-medium cursor-pointer"
      >
        Previous
      </button>

      <!-- CANCEL -->
      <button
        *ngIf="currentStep === 0"
        (click)="goBack()"
        class="bg-white border-2 border-[#D0D5DD] shadow-lg rounded-lg w-full py-2 text-black font-medium cursor-pointer"
      >
        Cancel
      </button>
    </div>
  </div>
</ion-content>
