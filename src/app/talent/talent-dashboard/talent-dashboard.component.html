<!-- Spinner overlay -->
<div
  *ngIf="showSpinner"
  class="fixed inset-0 flex items-center justify-center bg-white z-50"
>
  <app-spinner [loadingText]="loading"></app-spinner>
</div>

<!-- Dashboard content -->
<ion-content fullscreen (ionScroll)="onContentScroll($event)">
  <div [class.invisible]="showSpinner" class="min-h-screen flex flex-col">
    <!-- Header -->
    <app-talent-header
      [class.header-hidden]="headerHidden"
      [class.header-visible]="!headerHidden"
    ></app-talent-header>

    <!-- üß© MOCK MODE BADGE -->
    <div
      *ngIf="showMockBadge"
      class="fixed top-3 right-3 bg-yellow-500 text-white px-3 py-1 rounded-lg shadow-lg text-xs z-50 transition-opacity duration-700 ease-in-out animate-pulse"
      [ngClass]="{ 'opacity-0': !showMockBadge, 'opacity-100': showMockBadge }"
    >
      ‚ö†Ô∏è MOCK DATA ACTIVE
    </div>

    <div class="container mx-auto px-4 py-6 flex-1">
      <!-- Greeting -->
      <div class="flex items-center gap-3 mb-6">
        <img
          *ngIf="timeIcon"
          [src]="timeIcon"
          [alt]="timeOfDay + ' icon'"
          class="w-10 h-10 inline-block align-middle"
        />
        <span class="text-xl font-semibold text-black"
          >Good {{ timeOfDay }},
          <span class="text-xl font-light text-black">{{
            userName
          }}</span></span
        >
      </div>

      <!-- Dark Info Card - CREATE / MODIFY MARKET PROFILE -->
      <div
        class="dark-card-background relative rounded-lg p-6 mb-6 overflow-hidden"
      >
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black bg-opacity-70"></div>

        <!-- GRID CONTAINER -->
        <div class="relative z-10 grid grid-cols-1 md:grid-cols-2 gap-6 items-center">

          <!-- LHS Cell -->
          <div class="text-white">
            <div class="flex items-center gap-3 mb-3">
              <img [src]="myIcon" alt="myIcon" class="h-7 w-7" />
              <span class="font-semibold text-[20px] leading-tight">
          {{
                  isNewUser
                    ? "CREATE MARKET PROFILE"
                    : "MODIFY MARKET PROFILE"
                }}
        </span>
            </div>

            <p class="text-gray-200 mb-4 text-base leading-relaxed">
              {{
                isNewUser
                  ? "You can create your market profile here."
                  : "You can update your market profile here."
              }}
            </p>

            <ion-button
              fill="clear"
              class="bg-transparent border border-white rounded-lg text-white hover:bg-white hover:text-black transition"
              (click)="proceedToMarketProfile()"
            >
              Proceed
            </ion-button>
          </div>

          <!-- RHS Cell -->
          <div class="flex justify-end">
            <div
              (click)="routeToWallet()"
              class="w-full max-w-sm bg-white rounded-lg shadow-md p-6 border border-gray-200 text-left cursor-pointer hover:bg-gray-50 transition-colors"
            >
              <div class="flex justify-between items-center mb-2">
                <p class="text-gray-500 text-sm">Wallet Balance</p>

                <button
                  (click)="toggleBalanceVisibility($event)"
                  class="text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <ng-container *ngIf="balanceHidden; else visibleIcon">
                      <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                      <path
                        fill-rule="evenodd"
                        d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10z"
                        clip-rule="evenodd"
                      />
                    </ng-container>

                    <ng-template #visibleIcon>
                      <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                      <path
                        fill-rule="evenodd"
                        d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10z"
                        clip-rule="evenodd"
                      />
                    </ng-template>
                  </svg>
                </button>
              </div>

              <ng-container *ngIf="balanceHidden; else showBalance">
                <h2 class="text-3xl font-bold text-gray-900">
                  ‚Ç¶‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢
                  <span class="text-sm font-normal text-gray-400 ml-2">
              (hidden)
            </span>
                </h2>
              </ng-container>

              <ng-template #showBalance>
                <h2 class="text-3xl font-bold text-gray-900">
                  ‚Ç¶{{ walletBalance | number: "1.0-2" }}
                </h2>
              </ng-template>
            </div>
          </div>

        </div>
      </div>

<!--      Wallet information notice-->
      <div *ngIf="!hasWalletProfile" class="alert" role="alert">
        <div class="alert-left">
          <svg
            class="alert-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 11h2v5m-2 0h4m-2.592-8.5h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>

          <p class="alert-text">
            <span class="alert-title">Action Required:</span>
            Complete your wallet onboarding to get hired.
          </p>
        </div>

        <button (click)="routeToWalletOnboarding()" class="alert-btn">Proceed</button>
      </div>


      <!-- Dashboard Statistics -->
      <div class="border py-6 px-3 mt-12 rounded-lg">
        <h3 class="text-xl font-semibold py-5 md:text-left">
          Talent's Dashboard Statistics
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div *ngFor="let card of dashboardCards" class="dashboard-stat-card">
            <h3 class="text-[16px] font-medium mb-4 flex items-center gap-2">
              <span
                class="h-3 w-3 rounded-full"
                [ngStyle]="{ 'background-color': getStatusColor(card.status) }"
              ></span>
              {{ card.title }}
            </h3>
            <p class="text-2xl font-semibold">{{ card.value }}</p>
          </div>
        </div>

        <!-- Total Market by Percentage -->
        <div class="py-4 mt-5">
          <h3 class="text-xl font-semibold">Total Market by Percentage</h3>
        </div>

        <div class="mt-10 flex flex-col justify-center items-center">
          <div
            class="w-full flex flex-col md:flex-row justify-center items-center gap-8"
          >
            <!-- Left: Concentric Circles -->
            <div
              class="relative flex items-center justify-center h-64 w-64 md:h-80 md:w-80"
            >
              <ng-container
                *ngFor="
                  let circle of percentageCircles;
                  let i = index;
                  trackBy: trackByCircle
                "
              >
                <svg
                  class="absolute"
                  [attr.width]="circle.size"
                  [attr.height]="circle.size"
                  [style.zIndex]="100 - i"
                >
                  <circle
                    cx="50%"
                    cy="50%"
                    [attr.r]="circle.size / 2 - 8"
                    fill="none"
                    stroke="#e5e7eb"
                    stroke-width="8"
                  />

                  <circle
                    cx="50%"
                    cy="50%"
                    [attr.r]="circle.size / 2 - 8"
                    fill="none"
                    [attr.stroke]="circle.color"
                    stroke-width="8"
                    [attr.stroke-dasharray]="
                      getCircumference(circle.size / 2 - 8)
                    "
                    [attr.stroke-dashoffset]="
                      getStrokeDashoffset(
                        circle.size / 2 - 8,
                        circle.percentage
                      )
                    "
                    class="transition-all duration-700 ease-in-out"
                    [attr.transform]="
                      'rotate(-90, ' +
                      circle.size / 2 +
                      ', ' +
                      circle.size / 2 +
                      ')'
                    "
                  ></circle>

                  <circle
                    [attr.cx]="
                      getProgressDotPosition(
                        circle.size / 2 - 8,
                        circle.percentage,
                        circle.size
                      ).x
                    "
                    [attr.cy]="
                      getProgressDotPosition(
                        circle.size / 2 - 8,
                        circle.percentage,
                        circle.size
                      ).y
                    "
                    r="5"
                    [attr.fill]="circle.color"
                  ></circle>
                </svg>
              </ng-container>
            </div>

            <!-- Right: Percentage Breakdown -->
            <div class="donut-legend w-full md:w-auto">
              <div
                *ngFor="let card of dashboardStatCards"
                class="donut-legend-item flex justify-between items-center px-4 py-3 bg-gray-50 rounded-lg mb-3"
              >
                <div class="flex items-center gap-3">
                  <span
                    class="h-3 w-3 rounded-full flex-shrink-0"
                    [ngStyle]="{
                      'background-color': getPercentageStatusColor(card.status),
                    }"
                  ></span>
                  <span
                    class="text-gray-700 text-sm font-medium whitespace-nowrap"
                    >{{ card.title }}</span
                  >
                </div>
                <span class="text-lg font-semibold text-gray-900"
                  >{{ card.value | number: "1.2-2" }}%</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ratings Card -->
      <div class="border py-6 px-3 mt-12 rounded-lg">
        <h3 class="px-4 text-xl font-semibold mb-6">My Recent Market Rating</h3>

        <!-- Show empty state for new users or when no rating data -->
        <div
          *ngIf="isNewUser || !ratingsData || ratingsData.length === 0"
          class="flex flex-col items-center mt-10"
        >
          <img
            class="w-[232px] h-[246px]"
            [src]="images.NoDataImage"
            alt="No Data"
          />
          <div class="text-center space-y-2 mt-6">
            <h3 class="text-[#000000] font-semibold text-[20px]">
              No Ratings Yet
            </h3>
            <p class="text-[#000000] text-[16px]">
              {{
                isNewUser
                  ? "Complete your market profile to start receiving ratings"
                  : "Your market ratings will appear here after engagements"
              }}
            </p>
          </div>
        </div>

        <!-- Show chart when there's rating data -->
        <div
          *ngIf="!isNewUser && ratingsData && ratingsData.length > 0"
          class="px-4"
        >
          <div class="h-80">
            <canvas id="ratingsChart"></canvas>
          </div>
          <div class="flex justify-center gap-6 mt-6">
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full bg-blue-500"></span>
              <span class="text-sm text-gray-600">Your Ratings</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full bg-purple-600"></span>
              <span class="text-sm text-gray-600">Scouter's Ratings</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Hires -->
      <div class="border py-6 px-3 mt-12 rounded-lg">
        <div class="flex justify-between items-center mb-5 px-4">
          <h3 class="text-xl font-semibold">My Recent Hires</h3>
          <button
            *ngIf="!isNewUser && recentHires && recentHires.length > 0"
            (click)="goToViewHires()"
            class="bg-[#101828] text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-800 transition-colors"
          >
            View All Hires
          </button>
        </div>

        <!-- Show empty state for new users or when no hires -->
        <div
          *ngIf="isNewUser || !recentHires || recentHires.length === 0"
          class="flex flex-col items-center mt-10"
        >
          <img
            class="w-[232px] h-[246px]"
            [src]="images.NoDataImage"
            alt="No Data"
          />
          <div class="text-center space-y-2 mt-6">
            <h3 class="text-[#000000] font-semibold text-[20px]">
              No Hires Yet
            </h3>
            <p class="text-[#000000] text-[16px]">
              {{
                isNewUser
                  ? "Complete your market profile to start receiving offers"
                  : "Your recent hires will appear here"
              }}
            </p>
          </div>
        </div>

        <!-- Show hires list when there's data -->
        <div
          *ngIf="!isNewUser && recentHires && recentHires.length > 0"
          class="px-4"
        >
          <div class="space-y-4">
            <div
              *ngFor="let hire of recentHires"
              class="flex justify-between items-center py-4 border-b last:border-b-0 hover:bg-gray-50 transition-colors rounded-lg px-3"
            >
              <div class="flex items-center gap-3 flex-1">
                <img
                  [src]="hire.avatar"
                  alt="{{ hire.name }}"
                  class="w-12 h-12 rounded-full object-cover border border-gray-200"
                  onerror="this.src = 'assets/images/default-avatar.png'"
                />
                <div class="flex flex-col min-w-0">
                  <span class="text-sm font-medium text-gray-900 truncate">{{
                    hire.name
                  }}</span>
                  <span class="text-xs text-gray-500">{{ hire.date }}</span>
                  <span class="text-xs mt-1">
                    <span
                      [ngClass]="getHireStatusClass(hire.hireStatus)"
                      class="font-medium px-2 py-0.5 rounded-full bg-opacity-10"
                      [class.bg-green-100]="
                        hire.hireStatus === 'offer-accepted'
                      "
                      [class.bg-red-100]="hire.hireStatus === 'offer-declined'"
                      [class.bg-yellow-100]="
                        hire.hireStatus === 'awaiting-acceptance'
                      "
                    >
                      {{ getHireStatusText(hire.hireStatus) }}
                    </span>
                  </span>
                </div>
              </div>
              <div class="text-right ml-4">
                <div class="text-gray-900 font-semibold text-lg">
                  ‚Ç¶ {{ hire.amount | number: "1.0-2" }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>
