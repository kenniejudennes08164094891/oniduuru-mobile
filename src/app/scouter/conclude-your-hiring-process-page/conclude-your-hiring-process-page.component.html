<ion-header>
  <app-scouter-header
    [class.header-hidden]="headerHidden"
    [class.header-visible]="!headerHidden"
  >
  </app-scouter-header>
</ion-header>

<ion-content class="ion-padding">
  <div
    class="paid-dark-card-background relative rounded-lg p-6 mb-6 overflow-hidden"
  >
    <!-- <div class="background absolute inset-0 bg-black bg-opacity-0 z-0"></div> -->

    <div class="flex items-center gap-5 mb-3 text-white">
      <ion-icon class="h-7 w-7" name="information-circle-outline"></ion-icon>
      <span class="font-semibold text-[24px] leading-tight"
        >Conclude Your Hiring Process</span
      >
    </div>
  </div>

  <p
    class="text-[#000000] text-[18px] font-medium border border-gray-300 bg-gray-50 px-5 py-3 rounded-md"
  >
    Preferred Skill Needed
  </p>

  <div
    class="flex justify-between items-center text-[#000000] text-[16px] font-medium mt-6"
  >
    <span>Selected Skill </span>
    <span>Pricing</span>
  </div>

  <!-- skill-set-tab.component.html -->
  <table class="min-w-full border border-gray-200 text-sm py-6">
    <tbody>
      <tr
        *ngFor="let skill of selectedSkills"
        class="hover:bg-gray-50 border-b flex justify-between items-center"
      >
        <td class="px-3 sm:px-6 py-6 flex items-center gap-2 sm:gap-3">
          <img [src]="images.SkillSetIcon" alt="ðŸ‘‰" />
          <div>
            <p class="text-sm sm:text-base font-medium text-gray-900">
              {{ skill.jobTitle }}
            </p>
            <p class="text-xs sm:text-sm text-gray-500">
              {{ skill.skillLevel || "N/A" }}
            </p>
          </div>
        </td>
        <td
          class="px-3 sm:px-6 py-3 text-xs sm:text-sm font-semibold text-gray-600 whitespace-nowrap"
        >
          {{ skill.amount | currency : "â‚¦" }}
        </td>
      </tr>
    </tbody>
  </table>

  <div class="text-right py-6 font-semibold">
    Î£ Total: {{ totalPrice | currency : "â‚¦" }}
  </div>

  <p
    class="text-[#000000] text-[18px] font-medium border border-gray-300 bg-gray-50 px-5 py-3 rounded-md"
  >
    Kindly Complete the details below
  </p>

  <form class="mt-10 space-y-4">
    <div class="space-y-3">
      <label>Purpose of scouting for professionals</label>
      <textarea
        [(ngModel)]="formData.purpose"
        name="purpose"
        rows="6"
        class="w-full resize-none placeholder:text-gray-400 text-[18px] font-medium border border-gray-300 bg-gray-50 rounded-md p-3"
        placeholder="Write the job description here.."
        required
      ></textarea>
    </div>

    <div class="space-y-3">
      <label>Input amount you intend to pay</label>
      <input
        [ngModel]="formData.amount | number : '1.0-0'"
        (ngModelChange)="onAmountChange($event)"
        name="amount"
        placeholder="1,000,000"
        class="py-2 px-2 w-full placeholder:text-gray-400 text-[18px] font-medium border border-gray-300 bg-gray-50 rounded-md"
        type="text"
        required
      />
    </div>

    <div class="space-y-3">
      <label>Choose a start date for the talent to commence work</label>
      <input
        [(ngModel)]="formData.startDate"
        name="startDate"
        class="py-2 px-2 w-full placeholder:text-gray-400 text-[18px] font-medium border border-gray-300 bg-gray-50 rounded-md"
        type="date"
        required
      />
    </div>

    <div class="space-y-2 mt-6">
      <!-- Show only Preview before confirmation -->
      <button
        *ngIf="!previewConfirmed"
        type="button"
        class="bg-[#000000] py-2 w-full mx-auto rounded-lg text-white disabled:bg-gray-400"
        [disabled]="!isFormValid"
        (click)="previewData()"
      >
        Preview Data
      </button>

      <!-- After preview clicked -->
      <ng-container *ngIf="previewConfirmed">
        <button
          type="button"
          class="bg-[#000000] py-2 w-full mx-auto rounded-lg text-white"
          (click)="hireTalent()"
        >
          Hire Talent
        </button>

        <button
          *ngIf="!isUpdated"
          type="button"
          class="bg-[#000000] py-2 w-full mx-auto rounded-lg text-white"
          (click)="updateRecord()"
        >
          Update Record
        </button>
      </ng-container>
    </div>
  </form>

  <!-- Preview Modal -->
  <ion-modal [isOpen]="isPreviewOpen" (didDismiss)="closePreview()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Preview Hiring Details</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closePreview()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <p><strong>Purpose:</strong> {{ formData.purpose }}</p>
        <p><strong>Amount:</strong> â‚¦{{ formData.amount | number }}</p>
        <p><strong>Start Date:</strong> {{ formData.startDate }}</p>

        <ion-list>
          <ion-list-header>Selected Skills</ion-list-header>
          <ion-item *ngFor="let skill of selectedSkills">
            <ion-label>
              {{ skill.jobTitle }} - {{ skill.skillLevel }}
            </ion-label>
            <ion-note slot="end">â‚¦{{ skill.amount | number }}</ion-note>
          </ion-item>
        </ion-list>

        <div class="text-right py-4 font-semibold">
          Î£ Total: {{ totalPrice | currency : "â‚¦" }}
        </div>

        <ion-button expand="block" color="dark" (click)="confirmPreview()">
          Confirm Preview
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
